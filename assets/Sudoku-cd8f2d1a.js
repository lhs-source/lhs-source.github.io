import{g as Me,B as C,D as Oe,C as oe,N as ge,d as se,h as ve,a as J,j as ae,m as Ae,c as we,i as He,b as Ue}from"./sudoku2utils-b36fba1f.js";import{d as Ie,r as G,k as ee,o as Ve,l as xe,c as g,e as T,F as D,h as q,n as X,q as Re,a as y,t as w,i as De}from"./app-f2535a55.js";const V=Me(C);function re(x={}){const{onError:_,onUpdate:M,onFinish:S,initBoard:h,difficulty:H=Oe}=x;let i=[],O=[];const P=()=>{i=new Array(C*C).fill(null).map((t,e)=>({...i[e],candidates:i[e].value==null?oe.slice():i[e].candidates}))},U=[{postFn:u,title:"Open Singles Strategy",fn:de,score:.1,type:"value"},{postFn:u,title:"Visual Elimination Strategy",fn:v,score:9,type:"value"},{postFn:u,title:"Single Candidate Strategy",fn:s,score:8,type:"value"},{title:"Naked Pair Strategy",fn:I,score:50,type:"elimination"},{title:"Pointing Elimination Strategy",fn:p,score:80,type:"elimination"},{title:"Hidden Pair Strategy",fn:Ce,score:90,type:"elimination"},{title:"Naked Triplet Strategy",fn:R,score:100,type:"elimination"},{title:"Hidden Triplet Strategy",fn:me,score:140,type:"elimination"},{title:"Naked Quadruple Strategy",fn:F,score:150,type:"elimination"},{title:"Hidden Quadruple Strategy",fn:Se,score:280,type:"elimination"}],te=()=>{i[0]!==null&&typeof i[0]=="object"||(i=Array.from({length:C*C},(e,n)=>{const l=(h==null?void 0:h[n])??null,r=l==null?[...oe]:[...ge];return{value:l,candidates:r}}))},Q=(t,e)=>{const n=[];for(let l=0;l<t.length;l++){const r=i[t[l]].candidates;for(let d=0;d<e.length;d++){const o=e[d];o&&r[o-1]!==null&&(r[o-1]=null,n.push({index:t[l],eliminatedCandidate:o}))}}return n},Y=t=>{const e=Math.sqrt(C),n=[],l=Math.floor(t/C);n.push(l);const r=Math.floor(t%C);n.push(r);const d=Math.floor(l/e)*e+Math.floor(r/e);return n.push(d),n},W=t=>{const e=$(t);return oe.filter(n=>!e.includes(n))},$=t=>t.map(e=>i[e].value).filter(Boolean),K=t=>i[t].candidates.filter(e=>e!==null),ne=(t,e)=>e.filter(n=>i[n].candidates.includes(t));function de(){const t=V;for(let e=0;e<t.length;e++)for(let n=0;n<C;n++){const l=ue(t[e][n]);if(l)return a(l);if(se(i))return S==null||S(ve(O,U)),!0}return!1}function ue(t){const e=[];for(let n=0;n<C;n++){const l=t[n];if(i[l].value==null&&(e.push({house:t,cellIndex:l}),e.length>1))break}return e.length===1?e[0]:null}function a(t){const e=W(t.house);return e.length>1?(_==null||_({message:"Board Incorrect"}),-1):(J(i,t.cellIndex,e[0]),[{index:t.cellIndex,filledValue:e[0]}])}function u(){const t=V.length;for(let e=0;e<t;e++)for(let n=0;n<C;n++){const l=V[e][n],r=$(l);for(let d=0;d<C;d++){const o=i[l[d]];o.candidates=o.candidates.filter(f=>!r.includes(f))}}return!1}const c=t=>new Array(C*C).fill(null).map((e,n)=>{const l=t[n]||null,r=l===null?[...oe]:[...ge];return{value:l,candidates:r}});function s(){const t=V.length;for(let e=0;e<t;e++)for(let n=0;n<C;n++){const l=V[e][n],r=W(l);for(let d=0;d<r.length;d++){const o=r[d],f=[];for(let B=0;B<C;B++){const A=l[B],m=i[A];if(ae(m.candidates,o)&&(f.push(A),f.length>1))break}if(f.length===1){const B=f[0];return J(i,B,o),[{index:B,filledValue:o}]}}}return!1}function v(){for(let t=0;t<i.length;t++){const n=i[t].candidates,l=[];for(let r=0;r<n.length&&(n[r]!==null&&l.push(n[r]),!(l.length>1));r++);if(l.length===1){const r=l[0];return J(i,t,r),[{index:t,filledValue:r}]}}return!1}function p(){const t=V.length;for(let e=0;e<t;e++)for(let n=0;n<C;n++){const l=V[e][n],r=W(l);for(let d=0;d<r.length;d++){const o=r[d];let f=!0,B=-1,A=-1,m=!0;const L=[];for(let E=0;E<l.length;E++){const b=l[E];if(ae(i[b].candidates,o)){const k=Y(b),Z=e===2?k[0]:k[2],j=e===2?k[1]:k[2];if(L.length>0&&(Z!==B&&(f=!1),A!==j&&(m=!1),f===!1&&m===!1))break;B=Z,A=j,L.push(b)}}if((f||m)&&L.length>0){const E=e===2?f?0:1:2,b=V[E][Y(L[0])[E]],k=[];for(let j=0;j<b.length;j++)L.includes(b[j])||k.push(b[j]);const Z=Q(k,[o]);if(Z.length>0)return Z}}}return!1}function N(t){let e=[],n=[-1];const l=V.length;for(let d=0;d<l;d++)for(let o=0;o<C;o++){const f=V[d][o];if(W(f).length<=t)continue;e=[],n=[-1];const B=r(f,0);if(B!==!1)return B}return!1;function r(d,o){for(let f=Math.max(o,n[o]);f<C-t+o;f++){n[o]=f+1,n[o+1]=f+1;const B=d[f],A=K(B);if(!(A.length===0||A.length>t)){if(e.length>0){const m=[...A];for(let L=0;L<e.length;L++){const E=e[L].candidates||[];for(let b=0;b<E.length;b++)m.includes(E[b])||m.push(E[b])}if(m.length>t)continue}if(e.push({cell:B,candidates:A}),o<t-1){const m=r(d,o+1);if(m!==!1)return m}if(e.length===t){const m=[];let L=[];for(let k=0;k<e.length;k++)m.push(e[k].cell),L=L.concat(e[k].candidates||[]);const E=d.filter(k=>!m.includes(k)),b=Q(E,L);if(b.length>0)return b}}}return o>0&&e.length>o-1&&e.pop(),!1}}function I(){return N(2)}function R(){return N(3)}function F(){return N(4)}function ce(t){let e=[],n=[-1];function l(d,o){for(let f=Math.max(o,n[o]);f<=C-t+o;f++){n[o]=f+1,n[o+1]=f+1;const B=f+1,A=ne(B,d);if(!(A.length===0||A.length>t)){if(e.length>0){const m=A.slice();for(let L=0;L<e.length;L++){const E=e[L].cells;for(let b=0;b<E.length;b++)ae(m,E[b])||m.push(E[b])}if(m.length>t)continue}if(e.push({candidate:B,cells:A}),o<t-1){const m=l(d,o+1);if(m!==!1)return m}if(e.length===t){const m=[];let L=[];for(let k=0;k<e.length;k++)m.push(e[k].candidate),L=L.concat(e[k].cells);const E=[];for(let k=0;k<C;k++)ae(m,k+1)||E.push(k+1);const b=Q(L,E);if(b.length>0)return b}}}return o>0&&e.length>o-1&&e.pop(),!1}const r=V.length;for(let d=0;d<r;d++)for(let o=0;o<C;o++){const f=V[d][o];if(W(f).length<=t)continue;e=[],n=[-1];const B=l(f,0);if(B!==!1)return B}return!1}function Ce(){return ce(2)}function me(){return ce(3)}function Se(){return ce(4)}const le=({strategyIndex:t=0,analyzeMode:e=!1}={})=>{var l,r;if(se(i))return e||S==null||S(ve(O,U)),!1;const n=U[t].fn();return(r=(l=U[t]).postFn)==null||r.call(l),n===!1?U.length>t+1?le({strategyIndex:t+1,analyzeMode:e}):(_==null||_({message:"No More Strategies To Solve The Board"}),!1):n===-1?!1:(e||M==null||M({strategy:U[t].title,updates:n,type:U[t].type}),typeof O[t]>"u"&&(O[t]=0),O[t]+=1,U[t].type)},ke=t=>{u();const e=i[t].invalidCandidates||[],n=i[t].candidates.filter(r=>Boolean(r)&&!e.includes(r));if(n.length===0)return!1;const l=we(n);return J(i,t,l),!0},_e=t=>{var n;const e=t-1;i[e].invalidCandidates=i[e].invalidCandidates||[],(n=i[e].invalidCandidates)==null||n.push(i[e].value),J(i,e,null),P(),i[t].invalidCandidates=[],fe(e)},fe=t=>{if(t+1>C*C)return i.forEach(e=>e.invalidCandidates=[]),!0;ke(t)?fe(t+1):_e(t)};function be(t,e){return t.hasSolution&&t.difficulty&&t.hasUniqueSolution&&He(e,t.difficulty)}const Be=()=>{const t=Array.from({length:C*C},(n,l)=>l);let e=Ue(H);for(;e>0&&t.length>0;){const n=Math.floor(Math.random()*t.length),l=t.splice(n,1)[0],r=i[l].value;J(i,l,null),P();const d=ie();be(d,H)?e--:J(i,l,r)}};function Le(t,e){return t.map((n,l)=>e[l]!==void 0?{title:n.title,freq:e[l]}:null).filter(Boolean)}function ie(){let t=O.slice(),e=JSON.parse(JSON.stringify(i)),n=!0;for(;n;)n=le({strategyIndex:n==="elimination"?1:0,analyzeMode:!0});const l={hasSolution:se(i),hasUniqueSolution:!1,usedStrategies:Le(U,O)};if(l.hasSolution){const o=ve(O,U);l.difficulty=o.difficulty,l.score=o.score}const r=z();O=t.slice(),i=e,t=O.slice(),e=JSON.parse(JSON.stringify(i));let d=[...z()];for(;d&&!d.every(Boolean);)d=he({analyzeMode:!0,iterationCount:0});return l.hasSolution&&typeof d!="boolean"&&(l.hasUniqueSolution=d&&d.every((o,f)=>o===r[f])),O=t.slice(),i=e,l}function pe(){fe(0);const t=JSON.parse(JSON.stringify(i));function e(){Be();const l=ie();return l.hasSolution&&l.difficulty?!Ae(H,l.difficulty):!0}function n(){i=t.slice()}for(;e();)n();return u(),z()}const Te=30,he=({analyzeMode:t=!1,iterationCount:e=0}={})=>{if(e>=Te)return!1;const n=z().slice();le({analyzeMode:t});const l=z().slice(),r=n.filter(Boolean).length===l.filter(Boolean).length;return!se(i)&&r?he({analyzeMode:t,iterationCount:e+1}):(i=c(l),u(),z())},Ne=()=>{let t=!0;for(;t;)t=le({strategyIndex:t==="elimination"?1:0});return z()},z=()=>i.map(t=>t.value),Ee=()=>i;return h?(i=c(h),u(),ie()):(te(),pe()),{solveAll:Ne,solveStep:he,analyzeBoard:ie,getBoard:z,generateBoard:pe,getRemainingCandidates:K,getInternalBoard:Ee}}function Fe(x){const{getInternalBoard:_}=re({initBoard:x});return _()}function qe(x){const{getInternalBoard:_}=re({difficulty:x});return _()}function ze(x){const _=[],{solveAll:M,analyzeBoard:S}=re({initBoard:x,onUpdate:i=>_.push(i)}),h=S();if(!h.hasSolution)return{solved:!1,error:"No solution for provided board!"};const H=M();return h.hasUniqueSolution?{solved:!0,board:H,steps:_,analysis:h}:{solved:!0,board:H,steps:_,analysis:h,error:"No unique solution for provided board!"}}function ye(x){const _=[],{solveStep:M,analyzeBoard:S}=re({initBoard:x,onUpdate:i=>_.push(i)}),h=S();if(!h.hasSolution)return{solved:!1,error:"No solution for provided board!"};const H=M();return H?h.hasUniqueSolution?{solved:!0,board:H,steps:_,analysis:h}:{solved:!0,board:H,steps:_,analysis:h,error:"No unique solution for provided board!"}:{solved:!1,error:"No solution for provided board!"}}const We={class:"flex",style:{display:"flex"}},je={class:"sudoku-table"},Je=["onClick","onKeyup"],Pe={key:0,class:"initial-number"},Qe={key:1,class:"input-number"},$e={key:2,class:"candidate-list"},Ke={class:"mode-list"},Ge={class:"number-pad"},Xe=["onClick"],Ye={class:"hint-list"},Ze={key:0},et={key:1},tt={key:0,class:"sudoku-table hint"},nt={key:0},lt={key:1,class:"candidate-list remove-candidate"},it={key:0,style:{color:"gold"}},ot={key:1},st={class:"step-list"},at={class:"strategy-list"},ut=Ie({__name:"Sudoku",setup(x){const _=G([]),M=G([]),S=G(null),h=G([]),H=G(null),i=G("number"),O=ee(()=>h.value.map(a=>a.input??a.value)),P=ee(()=>{if(S.value===null)return null;const a=h.value[S.value];return a.input??a.value}),U=ee(()=>{var s;if(M.value.length===0)return[];const a=v=>v.updates.map(p=>p.index),u=((s=M.value[0].steps)==null?void 0:s.reduce((v,p)=>v.concat(a(p)),[]))??[],c=new Set(u);return Array.from(c)}),te=ee(()=>{var a;return M.value.length===0?[]:((a=M.value[0].steps)==null?void 0:a.reduce((u,c)=>(c.updates.map(s=>{const v=u.find(p=>p.index===s.index);v?s.eliminatedCandidate&&v.eliminatedCandidate.includes(s.eliminatedCandidate)===!1?v.eliminatedCandidate.push(s.eliminatedCandidate):v.filledValue=s.filledValue:u.push({index:s.index,eliminatedCandidate:[s.eliminatedCandidate],filledValue:s.filledValue})}),u),[]))??[]});ee(()=>h.value.map(a=>a.candidateList));function Q(){const a=ye(O.value.map(u=>u));M.value.unshift(a)}function Y(a){S.value=a}function W(a,u){const c=Math.floor(a/9),s=a%9,v=Math.floor(c/3)*3+Math.floor(s/3);for(let p=0;p<9;p++){const N=h.value[c*9+p],I=h.value[s+p*9],R=h.value[Math.floor(v/3)*27+v%3*3+Math.floor(p/3)*9+p%3];N.value===null&&(N.candidateList=N.candidateList.filter(F=>F!==u)),I.value===null&&(I.candidateList=I.candidateList.filter(F=>F!==u)),R.value===null&&(R.candidateList=R.candidateList.filter(F=>F!==u))}}function $(a){if(_.value[S.value].value===null)if(i.value==="candidate"){const u=h.value[S.value];u.candidateList.indexOf(a)>=0?u.candidateList=u.candidateList.filter(c=>c!==a):u.candidateList.push(a)}else{const u=h.value[S.value];u.input=a,Re(()=>{u.input!==H.value.board[S.value]?u.error=!0:(u.error=!1,W(S.value,a)),console.log("displayTable.value",O.value);const c=ye(O.value);M.value.unshift(c)})}}function K(a,u){const c=u.key;if(c==="Backspace")h.value[a].input=null;else{const s=parseInt(c);s>=1&&s<=9&&$(s)}}function ne(a){i.value=a}function de(){var u;(u=M.value[0].steps)==null||u.forEach(c=>{c.updates.forEach(s=>{s.filledValue&&(h.value[s.index].input=s.filledValue,Y(s.index),$(s.filledValue)),s.eliminatedCandidate&&(h.value[s.index].candidateList=h.value[s.index].candidateList.filter(v=>v!==s.eliminatedCandidate))})})}function ue(){console.log("candidateAll",Fe(O.value))}return _.value=qe("expert"),h.value=_.value.map(a=>({value:a.value,input:null,error:!1,candidateList:a.candidates})),H.value=ze(_.value.map(a=>a.value)),Q(),Ve(()=>{window.addEventListener("keyup",a=>{S.value!==null&&K(S.value,a)})}),xe(()=>{window.removeEventListener("keyup",a=>{S.value!==null&&K(S.value,a)})}),(a,u)=>(y(),g(D,null,[T("div",We,[T("div",je,[(y(!0),g(D,null,q(h.value,(c,s)=>(y(),g("div",{key:s,class:X(["cell-frame",{selected:S.value===s,"left-border":s%3===0,"top-border":Math.floor(s/9)%3===0,"right-border":s%3===2,"bottom-border":Math.floor(s/9)%3===2,error:c.error===!0,"same-number":P.value!=null&&P.value===(c.value??c.input)}]),onClick:v=>Y(s),onKeyup:v=>K(s,v)},[c.value!==null?(y(),g("span",Pe,w(c.value),1)):c.input!==null?(y(),g("span",Qe,w(c.input),1)):(y(),g("div",$e,[(y(),g(D,null,q(9,v=>T("div",{class:X(["candidate",{"same-number":c.candidateList.indexOf(v)>=0&&v===(P.value??0)}]),key:v},w(c.candidateList.indexOf(v)>=0?v:""),3)),64))]))],42,Je))),128))]),T("div",null,[T("div",Ke,[T("div",{class:X({selected:i.value==="number"}),onClick:u[0]||(u[0]=c=>ne("number"))}," 정답 ",2),T("div",{class:X({selected:i.value==="candidate"}),onClick:u[1]||(u[1]=c=>ne("candidate"))}," 후보자 ",2)]),T("button",{onClick:de},"next step"),T("button",{onClick:ue},"candidate"),T("button",{onClick:Q},"regen hint"),T("div",Ge,[(y(),g(D,null,q(9,c=>T("div",{class:"num",key:c,onClick:s=>$(c)},w(c),9,Xe)),64))])])]),T("div",Ye,[(y(!0),g(D,null,q(M.value,(c,s)=>{var v;return y(),g("div",{key:s,class:"hint-item"},[c.solved===!1?(y(),g("div",Ze,"틀렸습니다!")):(y(),g("div",et,[s===0?(y(),g("div",tt,[(y(!0),g(D,null,q(c.board,(p,N)=>(y(),g("div",{key:N,class:X(["cell-frame",{"left-border":N%3===0,"top-border":Math.floor(N/9)%3===0,"right-border":N%3===2,"bottom-border":Math.floor(N/9)%3===2,"hint-target":U.value.includes(N)}])},[p?(y(),g("span",nt,w(p),1)):(y(),g("div",lt,[(y(),g(D,null,q(9,I=>{var R;return T("div",{class:X(["candidate",{}]),key:I},[(R=te.value.find(F=>F.index===N))!=null&&R.eliminatedCandidate.includes(I)?(y(),g("span",it,w(I),1)):(y(),g("span",ot))])}),64))]))],2))),128))])):De("",!0),T("div",null,"hintTarget: "+w(U.value),1),T("div",null,"hintFlat: "+w(te.value),1),T("div",st,[(y(!0),g(D,null,q(c.steps,(p,N)=>(y(),g("div",{key:N,class:"step"},[T("div",null,"다음 전략 : "+w(p.strategy),1),(y(!0),g(D,null,q(p.updates,(I,R)=>(y(),g("div",{key:R},[T("div",null,w(I.index)+"칸 : / "+w(I.filledValue)+"입력 / "+w(I.eliminatedCandidate)+"제거",1)]))),128))]))),128))]),T("div",at,[(y(!0),g(D,null,q((v=c.analysis)==null?void 0:v.usedStrategies,(p,N)=>(y(),g("div",{key:N,class:"strategy"},[T("div",null,"남은 전략 : "+w(p==null?void 0:p.title)+" "+w(p==null?void 0:p.freq)+"회",1)]))),128))])]))])}),128))])],64))}});export{ut as default};
